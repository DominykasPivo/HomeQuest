{% extends 'base.html' %}
{% block title %}Edit Property{% endblock %}
{% block content %}
{% load static %}

<h1>Edit Property</h1>
<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    {% for field in form %}
        {% if field.name != "image" %}
            <div id="field_{{ field.name }}">
                {{ field.label_tag }} {{ field }}
                {% if field.errors %}
                    <span style="color:red">{{ field.errors }}</span>
                {% endif %}
            </div>
        {% endif %}
    {% endfor %}
    <h2>Current Images</h2>
    <ul>
        {% for image_path in property.image_paths %}
            <li>
                <img src="{{ MEDIA_URL }}{{ image_path }}" alt="Property Image" style="max-width: 200px;">
                {% if property.image_paths|length > 1 %}
                    <button type="submit" name="delete_image" value="{{ image_path }}">Delete</button>
                {% else %}
                    <button type="button" disabled title="Cannot delete the only image" class="btn-disabled">Delete</button>
                {% endif %}
                <input type="file" name="replace_image_{{ forloop.counter0 }}" accept="image/*">
                <button type="submit" name="replace_image_btn" value="{{ image_path }}">Replace</button>
            </li>
        {% endfor %}
        {% if not property.image_paths %}
            <li>No image available.</li>
        {% endif %}
    </ul>
    <h2>Add New Image</h2>
    <input type="file" name="new_image" accept="image/*">
    <button type="submit" name="add_image_btn">Add Image</button>
    <br><br>
    <button type="submit" name="save_changes">Save Changes</button>
    <a href="{% url 'property_list' %}">Cancel</a>
</form>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        function toggleDuration() {
            var listingType = document.getElementById('id_listing_type');
            var durationDiv = document.getElementById('field_duration');
            if (listingType && durationDiv) {
                if (listingType.value === 'for_rent') {
                    durationDiv.style.display = '';
                } else {
                    durationDiv.style.display = 'none';
                }
            }
        }
        var listingType = document.getElementById('id_listing_type');
        if (listingType) {
            listingType.addEventListener('change', toggleDuration);
            toggleDuration(); // Initial call
        }
    });
</script>

<style>
    .btn-disabled {
        opacity: 0.5;
        cursor: not-allowed;
        background-color: #e9ecef;
    }
    </style>

{% endblock %}